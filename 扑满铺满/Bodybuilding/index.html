<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"  http-equiv="Access-Control-Allow-Origin" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>全民健身日</title>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="./js/jweixin-1.2.0.js"></script>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <div v-if="subscribe" id="app">
        <div v-if="show" class="main">
            <div class="More" v-on:click="More"><div class="Mores"></div><p>点我了解更多</p></div>
            <div class="Bodybuilding"></div>
            <div class="text">
                <h4>活动已结束</h4>
                <p>奖品将发放至方圆里公众号</p>
                <p>会员专区我的优惠券中，敬请查看!</p>
            </div>
            <a :href='STATUS'><div class="next"></div></a>
            <div v-if="subscribe == '0'" class="qrcode">
                <section>
                    <p>请先识别二维码关注公众号</p>
                    <img :src="code_img" alt="">
                    <img class="codes" :src="code_img" alt="">
                </section>
            </div>
        </div>

        <div v-else class="footer">
            <div class="go" v-on:click="More"></div>
            <div class="content">
                <p>大伙知道吗？</p>
                <p>为了纪念北京奥运会成功举办</p>
                <p>每年8月8日为“全民健身日”（Fitness Day）</p>
            </div>
            <div class="today"></div>
            <div class="slogan">
                <p>全民健身日的口号</p>
                <p>“天天健身，天天快乐”</p>
                <p>“好体魄，好生活”</p>
                <p>“全民健身，你我同行”</p>
                <p>方圆里相应合作商家</p>
            </div>
            <div class="logo">
                <img src="./img/logo1.png" alt="">
                <img src="./img/logo2.png" alt="">
            </div>
        </div>
    </div>
</body>
<script>
    var wxhs = 'puman_houmu'
     var openIds = 'oyulg05XM7CHaRUt9JlarBuSwAIU'
    const isDev = false
    const URLS = isDev ? 'http://192.168.1.193:8090' : 'http://www.homeamc.cn'
    let imgUrl = URLS + '/shopping/kaptcha/'

  

    const vm = new Vue({
        el: '#app',
        data:{
            show: true, subscribe: 0, code_img:'', STATUS: 0
        },
        computed: {
            
        },
        created(){
            this.verifyCare()
            this.code_img = './img/' + wxhs + '.jpg'
            this.activity()
            this.share()
        },
        methods:{
            More(){
                this.show = !this.show
            },
            activity(){  //获取活动主题列表
                $.ajax({
                    url: URLS +  '/shopping/fitActivi/activity',
                    type: 'post',
                    data:{},
                    dataType: 'json',
                    success: (res) =>{
                         console.log(res)
                        if(res.code == 200) this.STATUS = './home.html?STATUS=' + res.data[0].STATUS+'&wxh=' + wxhs+'&openId=' + openIds+'&Fraction='
                    }
                })
            },
            verifyCare(){  //验证是否关注
                $.ajax({
                    url: URLS +  '/shopping/fitActivi/verifyCare',
                    type: 'post',
                    data:{ wxh: wxhs, openId: openIds},
                    dataType: 'json',
                    success: (res) =>{
                        // console.log(res)
                        if(res.code == 200) this.subscribe = res.data.subscribe
                    }
                })
            },
            share(){  // 分享
                $.ajax({
                    url: URLS + '/shopping/fitActivi/shire',
                    type: 'post',
                    data: { wxh : wxhs, openId: openIds },
                    dataType: 'json',
                    success: res => {
                        // console.log(res)
                        if(res.code == 200) {
                            this.wxs(res)
                        }
                    }
                })
            },
            wxs(res){
                wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: res.data.appId, // 必填，公众号的唯一标识
                    timestamp: res.data.timestamp, // 必填，生成签名的时间戳
                    nonceStr: res.data.nonce, // 必填，生成签名的随机串
                    signature: res.data.signature,// 必填，签名
                    jsApiList: ['onMenuShareAppMessage', 'onMenuShareTimeline'] // 必填，需要使用的JS接口列表
                })
                wx.ready(() => {
                    wx.onMenuShareAppMessage({
                        title: '全民健身日', // 分享标题
                        desc: '动动手指，来赢取方圆里英派斯年卡吧!', // 分享描述
                        link: 'http://www.homeamc.cn/shopping/fit/seminar?wxh=' + wxhs, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: 'http://www.homeamc.cn/shopping/static/img/fit.png', // 分享图标
                        type: '', // 分享类型,music、video或link，不填默认为link
                        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                        success: (res)=> {
                            // console.log(res)
                            this.updateRecords()
                        },
                        fail: function (res) {
                            // console.log(res)
                        }
                    })
                    wx.onMenuShareTimeline({
                        title: '全民健身日', // 分享标题
                        link: 'http://www.homeamc.cn/shopping/fit/seminar?wxh=' + wxhs, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: 'http://www.homeamc.cn/shopping/static/img/fit.png', // 分享图标
                        success: (res)=> {
                            // console.log(res)
                            this.updateRecords()
                        },
                        fail: function (res) {
                            // console.log(res)
                        }
                    })
                })
            },
            updateRecords(){  // 分享
                $.ajax({
                    url: URLS + '/shopping/fitActivi/updateRecords',
                    type: 'post',
                    data: { openId: openIds },
                    dataType: 'json',
                    success: res => {
                        // console.log(res)
                        if(res.code == 200) {
                            
                        }
                    }
                })
            },
        }
    })


    $(document).ready(function(){
        (function () {
            var deviceWidth = document.documentElement.clientWidth
            if (deviceWidth > 640) deviceWidth = 640
            document.documentElement.style.fontSize = deviceWidth / (750 / 100) + 'px'   // 750 设计图大小  100 换算rem
        })()
    })
</script>
</html>